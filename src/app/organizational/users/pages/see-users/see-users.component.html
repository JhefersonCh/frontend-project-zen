<app-base-page
  title="Usuarios"
  [subtitle]="subtitle"
  previusUrl="/users/create"
>
  <section actions class="w-100">
    <div class="row justify-content-end">
      <div class="col-12 col-md-5 col-lg-3">
        <button
          mat-fab
          extended="true"
          class="w-100"
          [routerLink]="['../create']"
        >
          Agregar
        </button>
      </div>
    </div>
  </section>

  <section content>
    <!-- Componente de Pestañas -->
    <mat-tab-group
      [(selectedIndex)]="selectedTabIndex"
      (selectedIndexChange)="onTabChange($event)"
    >
      <!-- Pestaña de Búsqueda -->
      <mat-tab label="Búsqueda">
        <section class="d-flex flex-column row mx-0 pt-3">
          <app-search-fields
            [searchFields]="searchFields"
            [form]="form"
            [debounceTime]="300"
            (searchSubmit)="onSearchSubmit($event)"
            (searchChange)="onSearchChange($event)"
          ></app-search-fields>

          <div
            class="d-flex flex-row justify-content-center justify-content-md-end row mx-0"
          >
            <div
              class="row col-12 col-md-3 d-flex gap-1 gap-md-0 justify-content-center justify-content-md-end"
            >
              <div class="col-12 col-md-6 px-1">
                <button
                  class="w-100"
                  mat-fab
                  extended="true"
                  color="warn"
                  (click)="searchComponent.reset()"
                  [disabled]="!showClearButton"
                >
                  Limpiar filtros
                </button>
              </div>

              <div class="col-12 col-md-6 px-1">
                <button
                  class="w-100"
                  mat-fab
                  extended="true"
                  (click)="searchComponent.submitSearch(); selectedTabIndex = 1"
                >
                  Buscar
                </button>
              </div>
            </div>
          </div>
        </section>
      </mat-tab>

      <!-- Pestaña de Resultados -->
      <mat-tab label="Resultados">
        <div class="mat-elevation-z8 mt-4">
          <div class="overflow-auto mb-3">
            <table mat-table [dataSource]="dataSource">
              <!-- Definición de Columnas -->
              <ng-container matColumnDef="identificationType">
                <th mat-header-cell *matHeaderCellDef>Identificación</th>
                <td mat-cell *matCellDef="let user">
                  {{ user.identificationType.type }}
                </td>
              </ng-container>

              <ng-container matColumnDef="fullName">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let user">{{ user.fullName }}</td>
              </ng-container>

              <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef>Rol</th>
                <td mat-cell *matCellDef="let user">{{ user.role.name }}</td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let user">
                  <button
                    mat-icon-button
                    color="primary"
                    [routerLink]="['..', user.id, 'edit']"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="openDeleteUserDialog(user.id)"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>

            <mat-paginator
              [pageSize]="pageSize"
              [pageSizeOptions]="[5, 10, 25, 100]"
              (page)="onChangePagination($event)"
            ></mat-paginator>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </section>
</app-base-page>
